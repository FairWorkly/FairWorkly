# Database Required Fields Contract

> **Purpose**: Define the decision framework for Required vs Optional fields in FairWorkly entities, and document the rationale for each entity.

## Decision Framework

### 1. Foreign Key Fields

```
Is it 1:1 or 1:N relationship?
├── 1:1 → ✅ Required
└── 1:N → Does business allow "orphan" records?
        ├── No (must belong to parent) → ✅ Required
        │   Example: Employee.OrganizationId
        └── Yes (can exist independently) → ❌ Optional
            Example: RosterIssue.ShiftId
```

### 2. Enum/Status Fields

```
Does the enum have a safe default value?
├── Yes (safe default exists) → ✅ Required + Default
│   Example: IsResolved = false, Severity = Info
└── No (no safe default, 0 is invalid) → ✅ Required + Validator
    Example: Role, EmploymentType
    Implementation: Validator rejects Unknown/0 value
```

### 3. Business Core Data

```
Without this field, does the record still make sense?
├── No → ✅ Required
│   Example: RosterIssue.Description
└── Yes → ❌ Optional
    Example: RosterIssue.DetailedExplanation
```

### 4. Lifecycle Fields

```
When is this field populated?
├── At creation time → ✅ Required
│   Example: CreatedAt, OrganizationId
└── Updated later → ❌ Optional
    Example: ResolvedAt, WaivedByUserId
```

### 5. AI-Generated / Computed Fields

```
Is this field generated by AI or computed?
└── Yes → ❌ Optional
    Reason: Generation may fail or not apply
    Example: DetailedExplanation, Recommendation
```

---

## Entity Field Decisions

### Employee

| Field | Required? | Rationale |
|-------|-----------|-----------|
| `OrganizationId` | ✅ Required | 1:N but employee must belong to an org |
| `FirstName` | ✅ Required | Core identity |
| `LastName` | ✅ Required | Core identity |
| `Email` | ❌ Optional | Not all employees have/provide email |
| `Phone` | ❌ Optional | Not all employees have/provide phone |
| `EmploymentType` | ✅ Required + Validator | Enum with no safe default (Unknown = 0 invalid) |
| `Position` | ✅ Required | Needed for award level determination |
| `StartDate` | ✅ Required | Needed for compliance calculations |
| `EndDate` | ❌ Optional | Only set when employee leaves |
| `GuaranteedHours` | ❌ Optional | Only applies to part-time |
| `AwardLevelNumber` | ✅ Required | Needed for pay rate lookups |

### Shift

| Field | Required? | Rationale |
|-------|-----------|-----------|
| `OrganizationId` | ✅ Required | Multi-tenant isolation |
| `RosterId` | ✅ Required | Shift must belong to a roster |
| `EmployeeId` | ✅ Required | Shift must be assigned to someone |
| `Date` | ✅ Required | Core data |
| `StartTime` | ✅ Required | Core data |
| `EndTime` | ✅ Required | Core data |
| `HasMealBreak` | ✅ Required | Compliance check needs this |
| `MealBreakDuration` | ❌ Optional | Only if HasMealBreak = true |
| `HasRestBreaks` | ❌ Optional | Default false |
| `RestBreaksDuration` | ❌ Optional | Only if HasRestBreaks = true |
| `IsPublicHoliday` | ❌ Optional | Default false |
| `PublicHolidayName` | ❌ Optional | Only if IsPublicHoliday = true |
| `Location` | ❌ Optional | Not all orgs track location |
| `Notes` | ❌ Optional | Supplementary info |

### Roster

| Field | Required? | Rationale |
|-------|-----------|-----------|
| `OrganizationId` | ✅ Required | Multi-tenant isolation |
| `WeekNumber` | ✅ Required | Core identifier |
| `Year` | ✅ Required | Core identifier |
| `Status` | ✅ Required + Default | Enum with safe default (Draft) |
| `TotalShifts` | ❌ Optional | Computed/aggregated |
| `TotalHours` | ❌ Optional | Computed/aggregated |
| `TotalEmployees` | ❌ Optional | Computed/aggregated |

### RosterValidation

| Field | Required? | Rationale |
|-------|-----------|-----------|
| `OrganizationId` | ✅ Required | Multi-tenant isolation |
| `RosterId` | ✅ Required | Validation belongs to a roster |
| `Status` | ✅ Required + Default | Enum with safe default (Pending) |
| `StartedAt` | ✅ Required | Set at creation |
| `CompletedAt` | ❌ Optional | Set when validation finishes |
| `TotalShifts` | ❌ Optional | Populated after validation |
| `PassedShifts` | ❌ Optional | Populated after validation |
| `FailedShifts` | ❌ Optional | Populated after validation |
| `TotalIssuesCount` | ❌ Optional | Populated after validation |
| `CriticalIssuesCount` | ❌ Optional | Populated after validation |
| `AffectedEmployees` | ❌ Optional | Populated after validation |

### RosterIssue

| Field | Required? | Rationale |
|-------|-----------|-----------|
| `OrganizationId` | ✅ Required | Multi-tenant isolation |
| `RosterValidationId` | ✅ Required | Issue belongs to a validation run |
| `EmployeeId` | ✅ Required | Issue affects an employee |
| `ShiftId` | ❌ Optional | Some issues are employee-level (e.g., consecutive days) |
| `CheckType` | ✅ Required + Validator | Enum, must be explicitly set |
| `Severity` | ✅ Required + Validator | Enum, must be explicitly set |
| `Description` | ✅ Required | Core data - what's the issue |
| `DetailedExplanation` | ❌ Optional | AI-generated |
| `Recommendation` | ❌ Optional | AI-generated |
| `ExpectedValue` | ❌ Optional | Not all rules have numeric comparison |
| `ActualValue` | ❌ Optional | Not all rules have numeric comparison |
| `AffectedDates` | ❌ Optional | Only for multi-shift issues |
| `AffectedShiftsCount` | ❌ Optional | Only for multi-shift issues |
| `IsResolved` | ✅ Required + Default | Boolean with safe default (false) |
| `ResolvedByUserId` | ❌ Optional | Set when resolved |
| `ResolvedAt` | ❌ Optional | Set when resolved |
| `ResolutionNotes` | ❌ Optional | Set when resolved |
| `IsWaived` | ✅ Required + Default | Boolean with safe default (false) |
| `WaivedByUserId` | ❌ Optional | Set when waived |
| `WaivedAt` | ❌ Optional | Set when waived |
| `WaiverReason` | ❌ Optional | Set when waived |

### Payslip

| Field | Required? | Rationale |
|-------|-----------|-----------|
| `OrganizationId` | ✅ Required | Multi-tenant isolation |
| `PayrollValidationId` | ✅ Required | Payslip belongs to a validation |
| `EmployeeId` | ✅ Required | Payslip is for an employee |
| `PayPeriodStart` | ✅ Required | Core data |
| `PayPeriodEnd` | ✅ Required | Core data |
| `EmploymentType` | ✅ Required + Validator | Enum, must be explicitly set |
| `HourlyRate` | ✅ Required | Core data for compliance check |
| `OrdinaryHours` | ✅ Required | Core data |
| `SaturdayHours` | ✅ Required | Core data (can be 0) |
| `SundayHours` | ✅ Required | Core data (can be 0) |
| `PublicHolidayHours` | ✅ Required | Core data (can be 0) |
| `OvertimeHours` | ❌ Optional | Not all payslips have overtime |
| `OrdinaryPay` | ✅ Required | Core data |
| `SaturdayPay` | ✅ Required | Core data (can be 0 or negative) |
| `SundayPay` | ✅ Required | Core data (can be 0 or negative) |
| `PublicHolidayPay` | ✅ Required | Core data (can be 0 or negative) |
| `OvertimePay` | ❌ Optional | Not all payslips have overtime |
| `CasualLoadingPay` | ❌ Optional | Only for casual employees |
| `Allowances` | ❌ Optional | Not all payslips have allowances |
| `GrossPay` | ✅ Required | Core data |
| `Tax` | ✅ Required | Core data |
| `Superannuation` | ✅ Required | Core data |
| `OtherDeductions` | ❌ Optional | Not all payslips have deductions |
| `NetPay` | ✅ Required | Core data |

### User

| Field | Required? | Rationale |
|-------|-----------|-----------|
| `OrganizationId` | ✅ Required | 1:N but user must belong to an org |
| `Email` | ✅ Required | Core identity / login |
| `FirstName` | ✅ Required | Core identity |
| `LastName` | ✅ Required | Core identity |
| `Role` | ✅ Required + Validator | Enum, Unknown = 0 is invalid |
| `PasswordHash` | ❌ Optional | Null for OAuth users |
| `RefreshToken` | ❌ Optional | Set after login |
| `RefreshTokenExpiryTime` | ❌ Optional | Set after login |
| `LastLoginAt` | ❌ Optional | Set after first login |

### Organization

| Field | Required? | Rationale |
|-------|-----------|-----------|
| `Name` | ✅ Required | Core identity |
| `ContactEmail` | ✅ Required | Primary contact |
| `SubscriptionTier` | ✅ Required + Default | Enum with safe default (Free) |
| `Industry` | ❌ Optional | Nice to have |
| `ABN` | ❌ Optional | Nice to have |
| `Address` | ❌ Optional | Nice to have |
| `CurrentEmployeeCount` | ✅ Required + Default | Has default (0) |

### Award

| Field | Required? | Rationale |
|-------|-----------|-----------|
| `Code` | ✅ Required | Unique identifier |
| `Name` | ✅ Required | Display name |
| `AwardType` | ✅ Required + Validator | Enum, must be explicitly set |
| All rate/config fields | ✅ Required | Core compliance data |

---

## Implementation Patterns

### Pattern 1: Required + Validator (for Enums without safe default)

```csharp
// Entity
public required EmploymentType EmploymentType { get; set; }

// Validator
public class EmployeeValidator : AbstractValidator<Employee>
{
    public EmployeeValidator()
    {
        RuleFor(x => x.EmploymentType)
            .NotEqual(EmploymentType.Unknown)
            .WithMessage("EmploymentType must be explicitly set");
    }
}

// Enum definition
public enum EmploymentType
{
    Unknown = 0,  // Invalid default
    FullTime = 1,
    PartTime = 2,
    Casual = 3
}
```

### Pattern 2: Required + Default (for Enums/Booleans with safe default)

```csharp
// Entity
public RosterStatus Status { get; set; } = RosterStatus.Draft;
public bool IsResolved { get; set; } = false;

// EF Configuration
builder.Property(x => x.Status)
    .HasDefaultValue(RosterStatus.Draft);
```

### Pattern 3: Optional with Conditional Logic

```csharp
// Entity
public int? MealBreakDuration { get; set; }

// Only valid when HasMealBreak = true
// Validator
RuleFor(x => x.MealBreakDuration)
    .NotNull()
    .When(x => x.HasMealBreak)
    .WithMessage("MealBreakDuration required when HasMealBreak is true");
```

---

## Quick Reference

| Pattern | When to Use | Example |
|---------|-------------|---------|
| `✅ Required` | Always needed, no default | OrganizationId, Description |
| `✅ Required + Default` | Always needed, has safe default | IsResolved = false |
| `✅ Required + Validator` | Always needed, enum with no safe 0 | Role, EmploymentType |
| `❌ Optional` | May not apply, set later, AI-generated | ResolvedAt, DetailedExplanation |
| `❌ Optional + Conditional` | Required only in certain conditions | MealBreakDuration when HasMealBreak |

---

## Change Log

| Date       | Author | Change |
|------------|--------|--------|
| 2026-02-06 | -      | Initial contract created |
